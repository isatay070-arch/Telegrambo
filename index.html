<!DOCTYPE html>
<html>
<head>
    <title>Auto Telegram Sender</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial;
            background: #667eea;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 20px;
            font-size: 20px;
            border-radius: 10px;
            width: 100%;
            margin: 20px 0;
            cursor: pointer;
        }
        #status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ –ê–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∞</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ‚Üí —Ñ–æ—Ç–æ + –≥–µ–æ ‚Üí –≤–∞—à Telegram</p>
        
        <!-- –û–î–ù–ê –ö–ù–û–ü–ö–ê -->
        <button onclick="sendAuto()">üì∏ –û–¢–ü–†–ê–í–ò–¢–¨ –§–û–¢–û –ò –ì–ï–û</button>
        
        <div id="status"></div>
        
        <p style="color: #666; font-size: 14px; margin-top: 20px;">
            –í—Å—ë –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–º–∏–Ω—É
        </p>
    </div>

    <script>
    async function sendAuto() {
        const btn = document.querySelector('button');
        btn.disabled = true;
        btn.textContent = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
        
        try {
            // 1. –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
            const location = await new Promise((resolve, reject) => {
                navigator.geolocation.getCurrentPosition(
                    pos => resolve({
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude
                    }),
                    () => reject(new Error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –≥–µ–æ'))
                );
            });
            
            // 2. –§–æ—Ç–æ
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'environment' }
            });
            
            const video = document.createElement('video');
            video.srcObject = stream;
            
            await new Promise(resolve => {
                video.onloadedmetadata = () => {
                    video.play();
                    resolve();
                };
            });
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            stream.getTracks().forEach(track => track.stop());
            
            // 3. –û—Ç–ø—Ä–∞–≤–∫–∞
            showStatus('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞...', 'success');
            
            const response = await fetch('https://–≤–∞—à-—Å–∞–π—Ç.vercel.app/api/send', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    latitude: location.lat,
                    longitude: location.lon,
                    photo: canvas.toDataURL('image/jpeg').split(',')[1]
                })
            });
            
            const result = await response.json();
            
            if (result.ok) {
                showStatus('‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω—É!', 'success');
            } else {
                throw new Error(result.error);
            }
            
        } catch (error) {
            showStatus('‚ùå ' + error.message, 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'üì∏ –û–¢–ü–†–ê–í–ò–¢–¨ –§–û–¢–û –ò –ì–ï–û';
        }
    }
    
    function showStatus(msg, type) {
        const status = document.getElementById('status');
        status.textContent = msg;
        status.className = type;
        status.style.display = 'block';
    }
    </script>
</body>
</html>
